"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var httpProxy=require("http-proxy");const hasRequestBodyMethods=["HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","PATCH"],rewritePath=(e,t)=>{if(t)if(Array.isArray(t))for(const i of t){var{patternStr:r,replaceStr:o}=i,r=RegExp(r);if(r.test(e))return e.replace(r,o)}else{console.warn("[next-http-proxy-middleware] Use array instead of object for `pathRewrite` value (related issue: https://github.com/stegano/next-http-proxy-middleware/issues/39)");for(const n in t){var s=RegExp(n),a=t[n];if(s.test(e))return e.replace(s,a)}}return e},httpProxyMiddleware=async(i,n,d={})=>new Promise((e,t)=>{const{pathRewrite:r,onProxyInit:o,...s}=d;var a=httpProxy.createProxy();"function"==typeof o&&o(a),r&&(i.url=rewritePath(i.url,r)),0<=hasRequestBodyMethods.indexOf(i.method)&&"object"==typeof i.body&&(i.body=JSON.stringify(i.body)),a.once("proxyReq",(e,t)=>{0<=hasRequestBodyMethods.indexOf(t.method)&&"string"==typeof t.body&&(e.write(t.body),e.end())}).once("proxyRes",e).once("error",t).web(i,n,{changeOrigin:!0,...s})});exports.default=httpProxyMiddleware,exports.rewritePath=rewritePath;
